<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Movement</title>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <script src="enemy2.js"></script>
    <script src="player2.js"></script>
    <script src="bullet.js"></script>
    <script src="enemyBullet.js"></script>
    <script>
        var canvas, canvasContext/*, imageAssests*/;
        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
//            imageAssests = loadImgAssests();
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
            setInterval(mainLoop, 1000 / 50);

        }
                var ship = new Image();
                ship.src = 'images/ship.jpg';
                var enemy = new Image();
                enemy.src = 'images/invaders.png';
                var enemy2 = new Image();
                enemy2.src = 'images/invaders2.jpg';
            
//    function loadImgAssests() {
//        imgs = {};
//        
//        imgs.player = new Image();
//        imgs.player.src = "images/ship.jpg";
//        
//        return imgs;
//            }
           var changeDelay = 0;
        var enemySprite = false;
        var enemies = [];
        var settingUp = true;
        var enemyCount = 0;
        var enemyTotal =10;
        //var enemySprite = false;
        var eGap = 3;
        var player = [];
      //  var shooting = false;
        var bullets = [];
        var enemybullets = [];
        
        var scoreIncrease = false;
        var score = 0;
        
        var enemySprites = [];
        var enemyimgFrameX = 0;
        var enemyimgFrameY = 0;
        const WIDTH = 40;
        const HEIGHT = 25;
        var pXspeed = 4;
        var pXpos = 0;
        var pYpos = 400 - HEIGHT - 4;
        var pWidth = 70;
        var pHeight = 113;
        var color = 'white';
        
//        var healthImgWidth = 20;
//        var healthImgHeight = 20;
//        var health1Xpos = 10;
//        var health2Xpos = 2;
//        var health3Xpos = 2;
//        var healthImgGap = 5;
        
        var settingUp = true;
       var ship = new Player(ship, enemyimgFrameX, enemyimgFrameY, pHeight, pWidth, pXpos, pYpos, WIDTH, HEIGHT,pXspeed);


        
        function mainLoop() {
            colorRect(0, 0, canvas.width, canvas.height, "black");
            text(2,16,'white', '14pt Century Gothic',"Your score is: "  + score);
            gameWon();
            enemyBulletShooting();
//           var one = drawImg(canvas.width-healthImgWidth-1, health1Xpos,imageAssests.player,healthImgWidth,healthImgHeight);
//               
//            
//           var two =  drawImg(canvas.width-healthImgWidth *2 - healthImgGap, health2Xpos,imageAssests.player,healthImgWidth,healthImgHeight);
//            
//            var three = drawImg(canvas.width-healthImgWidth *3 - healthImgGap *2, health3Xpos,imageAssests.player,healthImgWidth,healthImgHeight);

            
            ship.drawplayerImage();
//            health1.drawplayerImage();
            ship.movePlayer();
           playerScore();
            
            if (settingUp) {
                setUp();
                settingUp = false;
            }
            if (enemies.length > 0) {
                enemies.forEach(function(item, index) {
                    item.drawingEnemy();
                    item.enemyDrop();
                    item.enemyMove();
                //    item.spriteChange();
                   // item.enemyChange();
                });
            }
            if (bullets.length > 0) {
                bullets.forEach(function(item, index) {
                    item.drawingBullet();
                    item.bulletMove();
                    
            if (item.outOfBounds() || item.hasCollided()) {
                        delete bullets[index];
                    }
 
                });
                bullets = bullets.filter(item => item !== undefined);
            }

            if (enemybullets.length > 0) {
                enemybullets.forEach(function(item, index) {
                    item.enemyBulletMove();
                    item.drawingEnemyBullet();
                    
            if (item.outOfBounds()) {
                        delete enemybullets[index];
                    }
                });
                enemybullets = enemybullets.filter(item => item !== undefined);
            }
            
        }
//        if (spaceKeyPressed && shooting) {
//            shooting = false;
//        }
        function setUp() {
            drawEnemyBullet();
           // spriteChange();
            for (i = 0; i < enemyTotal; i++) {
                drawMakeEnemies();
            }
            for(i=0;i<2;i++){
                enemySprites[i] = new Array(2);
                enemySprites[i][0] = 50 * i;
                enemySprites[i][1] = 0;
            }
        }
        function playerScore() {
            
            if(scoreIncrease){
                score++;
               console.log("your score is: " + score);
                scoreIncrease = false;
               }
        }
//    function drawImg(topLeftX,topLeftY,img,width,height) {
//	   canvasContext.drawImage(img,topLeftX,topLeftY,width,height);
//}
var shootingDelay = Math.floor(Math.random() * 10); 
        //console.log(shootingDelay);
function enemyBulletShooting(){
    
    if(shootingDelay <= Math.floor(Math.random() * 20) + 10){
        shootingDelay = shootingDelay + 0.1;
        
        
       }
    else{
       // console.log(shootingDelay);
        drawEnemyBullet();
        shootingDelay = 0;
    }
}
function gameWon(){
    if(score == 10){
        console.log("won");
        colorRect(0,0,canvas.width,canvas.height,"black");
       }
}
    function text(topLeftX,topLeftY,color, sizeFont, message){
        canvasContext.font = sizeFont;
        canvasContext.fillStyle = color;
        canvasContext.fillText(message, topLeftX, topLeftY);
    }

        function colorRect(x, y, w, h, color) {
            canvasContext.fillStyle = color;
            canvasContext.fillRect(x, y, w, h);
        }
    </script>
</body>
</html>