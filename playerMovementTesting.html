<!DOCTYPE html>
<html lang="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Movement</title>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <script src="enemy2.js"></script>
    <script src="player2.js"></script>
    <script src="bullet.js"></script>
    <script>
        var canvas, canvasContext;



        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');


            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
            setInterval(mainLoop, 1000 / 50);
        }


                var ship = new Image();
                ship.src = 'images/ship.png';
                var enemy = new Image();
                enemy.src = 'images/invaders.png';
                var enemy2 = new Image();
                enemy2.src = 'images/invaders2.png';
        
        var enemies = [];
        var settingUp = true;
        var enemyCount = 0;
        var enemyTotal =11;
        var eGap = 0;

        var player = [];
        var shooting = false;

        var bullets = [];
        var enemyBullet = [];
        
        var enemySprites = [];
        var enemyimgFrameX = 0;
        var enemyimgFrameY = 0;


        const WIDTH = 40;
        const HEIGHT = 25;
        var pXspeed = 4;
        var pXpos = 0;
        var pYpos = 400 - HEIGHT - 4;
        var pWidth = 70;
        var pHeight = 113;
        var color = 'white';
        
        var settingUp = true;


       var ship = new Player(ship, enemyimgFrameX, enemyimgFrameY, pHeight, pWidth, pXpos, pYpos, WIDTH, HEIGHT,pXspeed);

        
        function mainLoop() {
            colorRect(0, 0, canvas.width, canvas.height, "black");

            ship.drawplayerImage();
            ship.movePlayer()


            if (settingUp) {
                setUp();
                settingUp = false;
            }

            if (enemies.length > 0) {
                enemies.forEach(function(item, index) {
                    item.drawingEnemy();
                    item.enemyDrop();
                    item.enemyMove();
                });
            }

            if (bullets.length > 0) {
                bullets.forEach(function(item, index) {
                    item.drawingBullet();

                    item.bulletMove();
                    if (item.outOfBounds() || item.hasCollided()) {
                        delete bullets[index];
                    }
                });

                bullets = bullets.filter(item => item !== undefined);
            
            }
            
        }

        if (spaceKeyPressed && shooting) {
            shooting = false;

        }


        function setUp() {
            for (i = 0; i < enemyTotal; i++) {
                drawMakeEnemies();
            }
            for(i=0;i<2;i++){
                enemySprites[i] = new Array(2);
                enemySprites[i][0] = 50 * i;
                enemySprites[i][1] = 0;
            }
        }
        
        const RIGHT = 39;
        const LEFT = 37;
        const SPACE = 32;
        var rightKeyPressed = false;
        var leftKeyPressed = false;
        var spaceKeyPressed = false;

        function keyPressed(evt) {
            if (evt.keyCode == RIGHT) {
                rightKeyPressed = true;
            }

            if (evt.keyCode == LEFT) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == SPACE) {
                drawBullet();
                spaceKeyPressed = true;
                shooting = true;
            }
        }

        function keyReleased(evt) {

            if (evt.keyCode == RIGHT) {
                rightKeyPressed = false;
            }

            if (evt.keyCode == LEFT) {
                leftKeyPressed = false;
            }

        }
        
        function enemyFrameChange(){
            
        }


        function colorRect(x, y, w, h, color) {
            canvasContext.fillStyle = color;
            canvasContext.fillRect(x, y, w, h);
        }
    </script>
</body>
</html>